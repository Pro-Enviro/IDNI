<p-panel header="Clusters">
  <div class="mb-p">
    <p-card #panel>
      <div class="grid">
        <div class="col-10">
          <!--          <pre>{{clusters | json}}</pre>-->
          <p-autoComplete
            [suggestions]="filteredClusters"
            [(ngModel)]="selectedCluster"
            [dropdown]="true"
            placeholder="Cluster Name"
            optionLabel="name"
            optionValue="name"
            (completeMethod)="onSelect($event)"
            (onSelect)="onClusterSelect($event)"
          ></p-autoComplete>
        </div>
        <!--        <div class="col-2">-->
        <!--          <button pButton label="Save" icon="pi pi-save" [disabled]="clusterCompanies.length < 2" (click)="onSave()"></button>-->
        <!--        </div>-->
      </div>
    </p-card>
  </div>


  @if (clusterCompanies) {

    <div>
      <p>Companies included in this cluster: </p>
      <ul>
        <li *ngFor="let comp of clusterCompanies">{{ comp.name }}</li>
      </ul>
    </div>

    <div class="flex align-items-start justify-content-between mt-2">
      <div class="mr-3 p-2 w-full ">
        <p-card styleClass="mb-3 p-3">
          <ng-template pTemplate="header">
            <h3 class="m-0">{{ selectedCluster.name }} - Current Totals</h3>
          </ng-template>
          <div class="flex flex-column">
            <div class="col-6">
              <strong>Total Energy Use:</strong><br>
              <!--              {{ energyData | json }}-->
              TODO: Add conversion if units are not kWh
              {{ getTotalEnergy() }} kWh
            </div>
            <div class="col-6">
              <strong>Total CO2e Emissions:</strong><br>
              {{ getTotalCO2e() }} tons
            </div>
          </div>
        </p-card>
      </div>

      <!--      <div class="mr-3 p-2 w-full ">-->
      <!--        <p-card styleClass="mb-3 p-3">-->
      <!--          Recommendations drag area-->
      <!--        </p-card>-->
      <!--      </div>-->
      <div class="mr-3 p-2 w-full">
        <p-card styleClass="mb-3 p-3" pDroppable (onDrop)="drop()">
          <ng-template pTemplate="header">
            <h3 class="m-0">Recommendations Drag Area</h3>
          </ng-template>

          <ul class="list-none flex flex-column gap-2 p-0 m-0" *ngIf="appliedRecommendations">
            <li *ngFor="let reco of appliedRecommendations" class="p-2 border-round shadow-1">
              {{ reco.recommendation }}
            </li>
          </ul>

        </p-card>
      </div>

      <div class="mr-3 p-2 w-full ">
        <p-card styleClass="mb-3 p-3">
          <ng-template pTemplate="header">
            <h3 class="m-0">After Recommendations - Current Totals</h3>
          </ng-template>
          <div class="flex flex-column">
            <div class="col-6">
              <strong>Total Energy Use:</strong><br>
              {{ getTotalEnergy() | number:'1.0-2' }} kWh
            </div>
            <div class="col-6">
              <strong>Total CO2e Emissions:</strong><br>
              {{ getTotalCO2e() | number:'1.0-2' }} tons
            </div>
          </div>
        </p-card>
      </div>
    </div>
    <div class="mt-3">
      <h3>Available Recommendations</h3>
      <div class="flex flex-wrap">
        <ul class="list-none flex flex-row gap-2 p-0 m-0">

          <li
            *ngFor="let reco of availableRecommendations"
            class="p-2 border-round shadow-1 bg-white"
            pDraggable
            (onDragStart)="dragStart(reco)"
            (onDragEnd)="dragEnd()">
            <div class="flex flex-column">
              Recommendation: {{ reco.recommendation }}
              Estimated Energy saving: {{ reco.estimatedEnergySaving }}
              Estimated Cost Saving: {{ reco.estimatedSaving }}
              Estimated Cost to implement: {{ reco.estimatedCost }}
              Estimated Carbon Saving: {{ reco.estimatedCarbonSaving }}
              Payback Period: {{ reco.paybackPeriod }}
            </div>
          </li>
        </ul>
      </div>
    </div>
  }
</p-panel>

