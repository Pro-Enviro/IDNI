<!--<app-company-select (company)="getCompany($event)"></app-company-select>-->

<section>
    <div class="grid p-6">
      <div class="col-5">
        <div class="pet-card">
          <h3>Non Half-Hourly Data Guide</h3>
          <p-button type="button" styleClass="btn-style" (click)="fuelGuide = true" icon="pi pi-table" label="Guide"></p-button>
        </div>
      </div>
       <div class="col-5">
         <div class="pet-card">
           <h3 class="title pb-3">Select Company</h3>
           <p-dropdown [options]="companies" [(ngModel)]="selectedCompany" optionLabel="name" optionValue="id" (ngModelChange)="onSelectCompany()" [style]="{ width: '12rem'}" scrollHeight="350px" styleClass="table-dropdown"></p-dropdown>
         </div>
       </div>

      <div class="col-12">
        <div class="pet-card">
          <h3 class="title mb-3">Non HH Data</h3>
          <div class="pb-5">
            <button pButton (click)="addFuelType()" label="Add New Fuel Type" icon="pi pi-plus" class="btn-style"></button>
          </div>

          <p-tabView [(activeIndex)]="activeTab">
            <p-tabPanel *ngFor="let fuel of fuels; index as i" [header]="fuel.type" [style]="{'paddingBottom': '300px', cursor: 'pointer'}">

              <ng-template pTemplate="header">
                <div style="overflow: hidden; cursor: pointer">
                  <label *ngIf="selectedItem !== fuel" (dblclick)="showDialog(fuel)">{{ fuel.type }} </label>
                  <input pInputText type="text" class="p-inputtext-sm" *ngIf="display && selectedItem === fuel"
                         [(ngModel)]="nameChange" [placeholder]="fuel.type" [style]="{padding: '0.35rem 0.75rem', cursor: 'pointer'}"
                         (keydown)="onKeyDown($event)" (keydown.enter)="saveName(nameChange, fuel)">
                  <button pButton type="button" icon="pi pi-save" *ngIf="display && selectedItem === fuel"
                          class="btn h-2rem w-2rem ml-2"
                          (click)="saveName(nameChange, fuel)"></button>
                  <button pButton type="button" icon="pi pi-times" *ngIf="display && selectedItem === fuel"
                          class="btn-dark h-2rem w-2rem ml-2"
                          (click)="cancelNameChange()"></button>
                </div>
              </ng-template>

              <p-toast></p-toast>
              <p-confirmDialog header="Confirmation"></p-confirmDialog>

              <div class="flex justify-content-end p-3">
                <button pButton class="btn-style mr-2" pRipple icon="pi pi-file-excel" (click)="exportExcel(fuel)"></button>
                <p-button (click)="deleteFuelType($event, fuel)" icon="pi pi-times" styleClass="btn-dark p-3 border-round"></p-button>
              </div>
              <div class="flex justify-content-start p-3">
                <button pButton class="btn-style mr-2" icon="pi pi-plus" label="Import Spreadsheet"
                        (click)="importSpreadsheet(fuel)"></button>
                <button pButton class="btn-outline-upload mr-2" icon="pi pi-pencil" label="Edit Column"
                        (click)="editFuelType(fuel)"></button>
              </div>
              <p-table [value]="fuel.rows" styleClass="p-datatable-sm" #table [style]="{padding: 0}"
                       [columns]="getCols(fuel.cols)" [exportFilename]="fuel.type">

                <ng-template pTemplate="header">
                  <tr [style]="{width: '100px'}">
                    <th *ngFor="let col of fuel.cols" style="width: 150px" [pTooltip]="col.checked ? tooltipText(col) : '' "
                        tooltipPosition="top">{{ col.name }}
                    </th>
                    <th></th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-fuelRow let-i=rowIndex>
                  <tr style="width: 150px">
                    <td *ngFor="let col of fuelRow">
                      <p-calendar
                        *ngIf="col.type === 'date'"
                        [style]="{width: '150px', height: '2.5rem', marginBottom: '0'}"
                        [appendTo]="table"
                        [showIcon]="false"
                        [readonlyInput]="false"
                        dateFormat="dd/mm/y"
                        [(ngModel)]="col.value"
                        (onSelect)="calculateDays(fuelRow)"
                        (onBlur)="calculateDays(fuelRow)"
                      ></p-calendar>
                      <input pInputText class="p-inputtext-sm" style="width: 100px" *ngIf="col.type === 'text'"
                             [(ngModel)]="col.value"/>
                      <p-inputNumber mode="decimal" [minFractionDigits]="2" [maxFractionDigits]="5"
                                     prefix="{{col.prefix ? col.prefix : ''}}" suffix="{{col.suffix ? '' : ''}}"
                                     class="p-inputtext-sm" [inputStyle]="{width: '100px'}" *ngIf="col.type === 'number'"
                                     [(ngModel)]="col.value" (ngModelChange)="calculateCellValue(fuelRow)"></p-inputNumber>
                      <p-dropdown *ngIf="col.type === 'uom'" [options]="uomOptions"
                                  [style]="{width: '120px', height: '2.5rem', marginBottom: '2px'}" [appendTo]="table"
                                  [(ngModel)]="col.value"></p-dropdown>
                    </td>
                    <td>
                      <p-button icon="pi pi-trash" [rounded]="true" [text]="true" severity="danger"
                                (click)="deleteRow(fuel, i)"></p-button>
                    </td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="footer">
                  <div class="flex">
                    <button pButton icon="pi pi-plus" class="btn-dark-upload ml-2 mt-3" (click)="addNewRow(fuel)"></button>
                  </div>
                  <div class="pt-5 pb-5">
                    <button pButton icon="pi pi-save" label="Save" class="btn-style mt-3" (click)="saveFuel()"></button>
                  </div>
                </ng-template>
              </p-table>
            </p-tabPanel>
          </p-tabView>
        </div>

      </div>
    </div>
</section>


<p-sidebar [(visible)]="fuelGuide" position="right" styleClass="w-5">
  <div class="container">
    <h3 class="header-style">Non Half-Hourly Data Guide</h3>
    <p>The ‘non-half-hourly’ section is where you can add or upload data recorded from bills, including the individual monthly energy/fuel usage, rates, and costs.</p>
    <h3>How to Upload Non Half-Hourly Data Step by Step Guide</h3>
    <ul>
      <li>1. Click on "Add New Fuel Type" and select the fuel type from the dropdown menu.</li>
      <li>2. Once this steps is complete, you can choose which columns you want your table to contain. To do that, you can drag columns from "Available Columns" panel to "Selected Columns" panel.
        If you want to create a custom column, you need to navigate to "Custom Columns" panel, to type the name and when you are ready to click on "Create Column" button. The new custom column will be available in
        "Available Columns" panel, from there you can drag and drop your column in "Selected Columns". To calculate the "Totals", you can tick the checkboxes, available at "Columns to Total" panel. When you complete all
        of this steps you can click on "Done" button.
      </li>
      <li>3. Once you completed all of the steps above you will create a table, which you will have to fill.</li>
      <li>4. To edit the columns, you can click on "Edit Column" button. This will open a dialog with columns information, when you are ready with your changes you can click on "Update" button.</li>
    </ul>
    <h3>How to Upload Non Half-Hourly Data from a Spreadsheet Guide</h3>
    <ul>
      <li>1. Click on "Add New Fuel Type" and select the fuel type from the dropdown menu.</li>
      <li>2. Once this steps is complete, you can choose which columns you want your table to contain. To do that, you can drag columns from "Available Columns" panel to "Selected Columns" panel.
      If you want to create a custom column, you need to navigate to "Custom Columns" panel, to type the name and when you are ready to click on "Create Column" button. The new custom column will be available in
      "Available Columns" panel, from there you can drag and drop your column in "Selected Columns". To calculate the "Totals", you can tick the checkboxes, available at "Columns to Total" panel. When you complete all
      of this steps you can click on "Done" button.
    </li>
      <li>3. Once you completed all of the steps above you will create a table, with the columns that you chose.</li>
      <li>4. To import data from a spreadsheet, click on "Import Spreadsheet" button.</li>
      <li>5. When a new dialog is open, click on "Choose" button and select the file that you would like to upload.</li>
      <li>6. After completing the previous step, please click on "Upload" button.</li>
      <li>7. A new panel called "Select the sheet to import" will appear. Click on the sheet name that you would like to import.</li>
      <li>8. To fill all of the panels with information, you can drag the numbers from the table and place them into the panels.</li>
      <li>9. After completing the previous step, you can then click on "process" button. After you see the message: "Spreadsheet has been imported", you can then click on "Save & Close" button.</li>
      <li>10. After completing all of this steps, you have successfully imported the non half-hourly data spreadsheet.</li>

    </ul>
  </div>
</p-sidebar>
