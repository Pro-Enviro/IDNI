<!-- This component is making the links in header unclickable -->
<!--<app-top-page-img-tpl></app-top-page-img-tpl>-->

<section>
  <div class="container">
    <div class="grid">
      <div class="col-6">
        <div class="pet-card-dark">
          <h3>Half-Hourly Data Guide</h3>
          <p-button type="button" styleClass="btn-style mb-4" (click)="accessData = true" icon="pi pi-file" label="Access to Half-Hourly Electricity Data"></p-button>
          <p-button type="button" styleClass="btn-dark-upload" (click)="dataGuide = true" icon="pi pi-cloud-upload" label="Upload Half-Hourly Data Guide"></p-button>
        </div>
      </div>
      <div class="col-6">
        <div class="pet-card-dark" *ngIf="!fileContent && isConsultant">
          <h3 class="title pb-3">Select Company</h3>
          <p-dropdown [options]="companies" optionLabel="name" optionValue="id" [(ngModel)]="selectedCompany" [style]="{ width: '12rem'}" [disabled]="!isConsultant" scrollHeight="350px" styleClass="table-dropdown"></p-dropdown>
        </div>
<!--        <p-card *ngIf="!fileContent && selectedName" header="Select Company" [style]="{width: '70%', margin: 'auto', marginTop:'5rem'}" styleClass="card-charts">-->
<!--          {{selectedName}}-->
<!--        </p-card>-->
      </div>
      <div class="col-12 mt-5">
        <div class="pet-card" *ngIf="!fileContent" [style]="{width: '70%', margin: 'auto', marginTop:'4rem'}">
          <h3 class="title pb-3">File Upload</h3>
          <p-fileUpload name="file[]" [customUpload]="true"
                        (onSelect)="getFileType($event)"
                        (uploadHandler)="onUpload($event)"
                        [multiple]="false"
                        chooseStyleClass="btn-style-upload"
                        cancelStyleClass="btn-dark-upload"
                        uploadStyleClass="btn-outline-upload">
            <ng-template pTemplate="content" style="padding:30px">

              <ul *ngIf="uploadedFiles.length" style="list-style:none">
                <li *ngFor="let file of uploadedFiles">{{ file.name }} - {{ file.size }} bytes</li>
              </ul>
            </ng-template>
          </p-fileUpload>
        </div>

        <div class="pet-card mt-5" *ngIf="uploadedFiles.length && isConsultant">
          <p-selectButton [options]="availableSheets" [(ngModel)]="selectedSheet" (click)="getSheetData()" class="btn-select-fuel"></p-selectButton>
        </div>

        <div class="pet-card mt-5" *ngIf="uploadedFiles.length && !isConsultant">
          <p-button *ngIf="isXlsx" styleClass="btn-dark m-1"  label="Send Data" (click)="sendDataToProEnviro()"></p-button>
          <p>Send data to Pro Enviro to process</p>
        </div>

        <ng-container *ngIf="fileContent">
          <div class="pet-card mt-4"  #table>
            <h3 class="title">Half-Hourly Data (HHD)</h3>
            <div class="grid">
              <div class="col-3" pDroppable (onDrop)="dropMpan()">
                 <div class="enviro-card">
                   <h3 class="title">MPAN Number</h3>
                  <ul class="list-none flex flex-column gap-2 p-0 m-0 bg-white" *ngIf="selectedMpan">
                    <li class="p-2 border-round shadow-1">
                      {{selectedMpan.name}}
                    </li>
                  </ul>
                </div>
              </div>
              <div class="col-3" pDroppable (onDrop)="dropStartDate()">
                <div class="enviro-card">
                  <h3 class="title">Date Column</h3>
                  <ul class="list-none flex flex-column gap-2 p-0 m-0 bg-white" *ngIf="selectedStartDate" >
                    <li class="p-2 border-round shadow-1">
                      {{selectedStartDate.name}}
                    </li>
                  </ul>
                </div>
              </div>
              <div class="col-3" pDroppable (onDrop)="dropFirstData()">
                <div class="enviro-card">
                  <h3 class="title">Data Start Point</h3>
                  <ul class="list-none flex flex-column gap-2 p-0 m-0 bg-white" *ngIf="selectedDataStart" >
                    <li class="p-2 border-round shadow-1">
                      {{selectedDataStart.name}}
                    </li>
                  </ul>
                </div>
              </div>
              <div class="col-3">
                <div class="enviro-card">
                  <h3 class="title">Data Type</h3>
                  <ul class="list-none flex flex-column gap-2 p-0 m-0">
                    <li class="">
                      <p-toggleButton [(ngModel)]="reactiveData" onLabel="kVAr" offLabel="kWh" [style]="{ width: '10em', background:'#356c6b',color:'#ffffff',padding:'6px'}"></p-toggleButton>
                    </li>
                  </ul>
                </div>
              </div>
            </div>

            <p-table [value]="fileContent.slice(0,10)" [tableStyle]="{ 'min-width': '50rem' }">
              <ng-template pTemplate="body" let-row let-r="rowIndex">
                <tr>
                  <td *ngFor="let cell of row.slice(0,15); index as c">
                    <div pDraggable (onDragStart)="dragStart(cell, r, c)" (onDragEnd)="dragEnd()">{{ cell }}</div>
                  </td>
                </tr>
              </ng-template>
            </p-table>


            <p-progressBar class="my-5" *ngIf="uploadingData" mode="indeterminate" [style]="{ height: '6px' }"></p-progressBar>

            <div class="pt-3">
              <button pButton class="btn-style pt-3" icon="pi pi-cog" label="{{uploadingData ? 'Uploading Data' :'Process'}}" [disabled]="uploadingData"  (click)="processData()"></button>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</section>


<div class="flex justify-content-end">
  <div class="flex flex-column">
    <p-sidebar [(visible)]="accessData" position="right" styleClass="w-5">
      <div class="container p-3">
        <h3 class="header-style">How to access the half hourly electricity data?</h3>
        <p>This can only be obtained if your energy company records your consumption data on a half hourly basis. To obtain half-hourly meter data, you need to either download it or contact your electricity or utility provider to request it. They should be able to provide you with access to your half-hourly consumption data upon request.</p>
        <ul>
          <h4 class="font-italic font-normal">Guide on how to access your half-hourly data:</h4>
          <li>
            <h4>•	Identify whether you have a half-hourly meter</h4>
            <div class="grid">
              <div class="col-4">
                <img src="https://id-ni.eco/assets/images/dash-info/mapn-img.png" height="90px" alt="">
              </div>
              <div class="col"></div>
              <div class="col-6">
                <p>Look for the complete MPAN number in one of your electricity bills in this format: <br>
                  If the first two numbers are ‘00’, then you have a half-hourly meter. If it anything else, then it is not half-hourly.
                </p>
              </div>
            </div>
          </li>
          <li>
            <h4>•	Contact Your Utility Provider</h4>
            Start by reaching out to your electricity or utility provider. They should have information on whether your meter supports half-hourly data recording and how you can access it.
          </li>
          <li>
            <h4>•	Request Access</h4>
            Once you've confirmed that your meter supports half-hourly data recording, check first if you can download the half-hourly data from your online energy account, if not then send a request to your energy supplier.
          </li>
          <li>
            <h4>•	Provide Information</h4>
            Depending on your provider's procedures, you may need to provide some information such as your account details, meter number, and possibly consent to access the data.
          </li>
          <li>
            <h4>•	Access the Data</h4>
            After you've completed any necessary steps, you should be able to access your half-hourly meter data. This may be through an online portal downloadable file, by email, or through other means provided by your utility company.
          </li>
          <li>
            <h4>•	Analyse the Data</h4>
            Once you have access to your half-hourly meter data, you can analyse it to gain insights into your electricity usage patterns. This can be useful for identifying opportunities to reduce energy consumption, optimise energy usage, or for other purposes such as billing verification.
          </li>
        </ul>
        <p-divider></p-divider>
        <h3 class="pt-4 header-style">What data to get?</h3>
        <p>When obtaining half-hourly meter data, you receive information about your electricity consumption in half-hour intervals throughout the day.
          By analysing this half-hourly meter data, you can gain insights into your electricity usage patterns, identify opportunities for energy efficiency improvements,
          and optimise your energy consumption to reduce costs or environmental impact.
        </p>
        <ul>
          <h4 class="font-italic font-normal">Data points you might expect to receive:</h4>
          <li>
            <h4>•	Date and Time Stamp</h4>
            Each data point should include a timestamp indicating the date and time the measurement was taken. This allows you to track consumption patterns over specific periods.
          </li>
          <li>
            <h4>•	Meter Reading</h4>
            The actual electricity consumption recorded by the meter during each half-hour interval. This is usually measured in kilowatt-hours (kWh) or megawatt-hours (MWh), depending on the scale of your consumption.
          </li>
          <li>
            <h4>•	Meter ID or Serial Number</h4>
            A unique identifier for your meter, which helps ensure that the data corresponds to your specific meter and account.
          </li>
          <li>
            <h4>•	Quality Flags or Indicators</h4>
            Some datasets may include quality flags or indicators to denote the reliability of each measurement. This can help you identify and filter out any anomalous or unreliable data points.
          </li>
          <li>
            <h4>•	Tariff Information</h4>
            Information about the tariff or pricing structure applicable to each half-hour interval. This can be useful for understanding how your electricity costs vary throughout the day based on time-of-use pricing or other factors.
          </li>
        </ul>
      </div>
    </p-sidebar>


    <p-sidebar [(visible)]="dataGuide" position="right" styleClass="w-5">
      <div class="container">
        <h3 class="header-style">Guide on how to import half-hourly data</h3>
        <p>To import the half-hourly data you need to follow these steps:</p>
        <uL>
          <li>1. Select the company from the dropdown panel.</li>
          <li>2. Click on the "Choose" button located in "File Upload" panel.</li>
          <li>3. Select the file that you would like to upload.</li>
          <li>4. Click the "Upload" button.</li>
          <li>5. A new panel called "Half-Hourly Data (HHD)" is appearing, displaying a table holding information for - mpan number, date and data share point.</li>
          <li>6. To process the data, you will need to drag the information from the table into the panels above. For example: click on the MPAN number and drag the number into the panel that is called: "MPAN Number".
            Please complete the same step with filling the "Date Column" panel and "Data Share Point".
          </li>
          <li>7. When you completed all of the steps above, click on "Process" button.</li>
          <li>8. When you successfully upload the data, a message will appear on the right corner of the webpage: "Data saved to database".</li>
        </uL>
      </div>
    </p-sidebar>
  </div>
</div>






